<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#4CAF50" />

    <title>Trang ch·ªß</title>
    <link rel="stylesheet" href="css/style.css" />
    <style>
      #userInfo {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
      }
      img {
        border-radius: 50%;
        width: 80px;
        height: 80px;
      }
      #stats {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>üè† Trang ch·ªß</h1>

    <div id="userInfo"></div>

    <div id="stats">
      <p><strong>B√†i ƒë√£ ho√†n th√†nh:</strong> <span id="completed">0</span></p>
      <p><strong>T·ªïng ƒëi·ªÉm:</strong> <span id="totalScore">0</span></p>
    </div>

    <button onclick="location.href='import.html'">üì• Import c√¢u h·ªèi</button>

    <button onclick="location.href='select-quiz.html'">
      üìù B·∫Øt ƒë·∫ßu l√†m b√†i
    </button>
    <script type="module">
      import { initFirebaseAuth } from "./js/firebase.js";
      initFirebaseAuth();
    </script>
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service-worker.js");
      }
    </script>
    <script>
      function tinhSoNgayBoQua() {
        const last = localStorage.getItem("lastDoneDate");
        if (!last) return 10;

        const lastDate = new Date(last);
        const now = new Date();
        const diffTime = now - lastDate;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        return Math.min(diffDays, 10);
      }

      function layAnhEmotion(ngay) {
        if (ngay === 0) return "images/emotion/happy.svg";
        if (ngay <= 2) return "images/emotion/sad1.svg";
        if (ngay <= 5) return "images/emotion/cry.svg";
        return "images/emotion/dead.svg";
      }

      const days = tinhSoNgayBoQua();
      const img = document.createElement("img");
      img.src = layAnhEmotion(days);
      img.alt = `Bi·ªÉu c·∫£m sau ${days} ng√†y b·ªè b√†i`;
      img.style.width = "100px";
      img.style.height = "100px";
      img.title = `${days} ng√†y kh√¥ng l√†m b√†i`;

      const emoText = document.createElement("p");
      emoText.innerHTML = `<strong>Chu·ªói b·ªè b√†i:</strong> ${days} ng√†y`;

      const userInfoDiv = document.getElementById("userInfo");
      userInfoDiv.appendChild(img);
      userInfoDiv.appendChild(emoText);
    </script>
  </body>
</html>
