<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trang ch·ªß</title>
    <link rel="stylesheet" href="css/style.css" />
    <style>
      #userInfo {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
      }
      img {
        border-radius: 50%;
        width: 80px;
        height: 80px;
      }
      #stats {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>üè† <span style="color: black">Trang ch·ªß</span></h1>

    <div id="userInfo"></div>

    <div id="stats">
      <p><strong>B√†i ƒë√£ ho√†n th√†nh:</strong> <span id="completed">0</span></p>
      <p><strong>T·ªïng ƒëi·ªÉm:</strong> <span id="totalScore">0</span></p>
    </div>

    <!-- ‚úÖ N√∫t Import ·∫©n theo m·∫∑c ƒë·ªãnh -->
    <div id="importBtnContainer" style="display: none">
      <button onclick="location.href='import.html'">üì• Import c√¢u h·ªèi</button>
      <button onclick="location.href='import-2.html'">
        üì• Import c√¢u h·ªèi 2
      </button>
    </div>

    <button onclick="location.href='select-quiz.html'">
      üìù B·∫Øt ƒë·∫ßu l√†m b√†i
    </button>

    <!-- ‚úÖ X√°c th·ª±c v√† hi·ªÉn th·ªã n√∫t Import n·∫øu ƒë√∫ng email -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import { initFirebaseAuth } from "./js/firebase.js";
      initFirebaseAuth();

      const firebaseConfig = {
        apiKey: "AIzaSyBvNfpf4KQeJw9fuDkTyXdoDY3LEuUL1fc",
        authDomain: "abcd-9d83a.firebaseapp.com",
        projectId: "abcd-9d83a",
        storageBucket: "abcd-9d83a.appspot.com",
        messagingSenderId: "380338460918",
        appId: "1:380338460918:web:d1b1d7c9bc40471ded34d7",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const allowedEmail = "tqminh1982@gmail.com"; // ‚úÖ Ch·ªâ email n√†y ƒë∆∞·ª£c ph√©p Import

      onAuthStateChanged(auth, (user) => {
        if (user && user.email === allowedEmail) {
          document.getElementById("importBtnContainer").style.display = "block";
        }
      });
    </script>

    <script>
      function tinhSoNgayBoQua() {
        const last = localStorage.getItem("lastDoneDate");
        if (!last) return 10;
        const lastDate = new Date(last);
        const now = new Date();
        const diffTime = now - lastDate;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        return Math.min(diffDays, 10);
      }

      function layAnhEmotion(ngay) {
        if (ngay === 0) return "images/emotion/happy.png";
        if (ngay <= 2) return "images/emotion/sad.png";
        if (ngay <= 5) return "images/emotion/cry.png";
        return "images/emotion/dead.png";
      }

      const days = tinhSoNgayBoQua();
      const img = document.createElement("img");
      img.src = layAnhEmotion(days);
      img.alt = `Bi·ªÉu c·∫£m sau ${days} ng√†y b·ªè b√†i`;
      img.title = img.alt;

      const text = document.createElement("p");
      text.innerHTML = `<strong>Chu·ªói b·ªè b√†i:</strong> ${days} ng√†y`;

      const userInfo = document.getElementById("userInfo");
      userInfo.appendChild(img);
      userInfo.appendChild(text);
    </script>

    <script type="module" src="js/header.js"></script>
  </body>
</html>
